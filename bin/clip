#!/bin/bash -eu

SIZE_MAX=74994
OSC=$'\e]'
BEL=$'\a'

if [[ "$TERM" = "tmux" ]] || [[ "${TERM:0:5}" = "tmux-" ]]; then
  if [[ "$(tmux show-options -v set-clipboard)" = "off" ]]; then
    echo >&2 'clip: Error: Cannot set clipboard because tmux "set-clipboard" option is "off".'
    echo >&2 '             Run `tmux set-options -g set-clipboard on` or append next config to .tmux.conf'
    echo >&2 ''
    echo >&2 '             set -g set-clipboard on'
    echo >&2 ''
    exit 1
  fi
fi

data="$(cat "$@")"
size="${#data}"

if (( SIZE_MAX < size )); then
  echo "Too long input (max size: $SIZE_MAX, current size: $size)" >&2
  exit 1
fi

encoded_data="$(echo -n "$data" | base64 | tr -d '\r\n')"

echo -en "${OSC}52;c;${encoded_data}${BEL}"


